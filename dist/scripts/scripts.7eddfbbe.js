"use strict";angular.module("fallas",["ngAnimate","ngRoute","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/assignment",{templateUrl:"views/assignment.html",controller:"AssignmentCtrl"}).when("/examples",{templateUrl:"views/examples.html",controller:"ExamplesCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("fallas").controller("MainCtrl",function(){}),angular.module("fallas").controller("AssignmentCtrl",["$scope","frame","characteristics",function(a,b,c){function d(){a.model.result=b.evaluateFrames(_.values(b.definedFrames),a.model.elements)}a.model={characteristics:c,elements:{characteristic:"",entregaPactada:{date:new Date,time:new Date},entregaObtenida:{date:new Date,time:new Date},entregaCompleta:!0,entregaCorrecta:!0,entregaDefectuosa:!0,disponibilidad:!0}},a.handlers={submit:d}}]),angular.module("fallas").directive("fDateTimePick",function(){return{template:'<div class="form">\n    <div class="form-title">\n        {{title}}\n    </div>\n    <div class="form-group date-time">\n        <div class="input-group date">\n            <input type="text" class="form-control" datepicker-popup="{{format}}" ng-model="date" is-open="opened"\n                   min-date="minDate" max-date="\'2015-06-22\'" datepicker-options="dateOptions"\n                   date-disabled="disabled(date, mode)" close-text="Close"/>\n            <span class="input-group-btn">\n                <button type="button" class="btn btn-default" ng-click="open($event)">\n                    <i class="glyphicon glyphicon-calendar"></i>\n                </button>\n            </span>\n        </div>\n        <div class="input-group">\n            <timepicker ng-model="time"\n                        hour-step="hstep"\n                        minute-step="mstep"\n                        show-meridian="ismeridian">\n            </timepicker>\n        </div>\n        <span ng-click="removeElement()" class="pull-right glyphicon glyphicon-remove"></span>\n    </div>\n</div>',restrict:"E",scope:{date:"=",time:"=",title:"@"},link:function(a,b){a.today=function(){a.date=new Date},a.clear=function(){a.date=null,a.time=null},a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.toggleMin=function(){a.minDate=a.minDate?null:new Date(0)},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.toggleMode=function(){a.ismeridian=!a.ismeridian},a.update=function(){var b=new Date;b.setHours(14),b.setMinutes(0),a.time=b},a.removeElement=function(){b.remove()},a.time=new Date,a.hstep=1,a.mstep=15,a.options={hstep:[1,2,3],mstep:[1,5,10,15,25,30]},a.ismeridian=!0,a.dateOptions={formatYear:"yy",startingDay:1},a.initDate=new Date("2016-15-20");var c=["dd-MMMM-yyyy","yyyy/MM/dd","dd-MM-yyyy","shortDate"];a.format=c[2],a.toggleMin(),a.today()}}}),angular.module("fallas").directive("fSelect",function(){return{template:'<div class="form-group">\n    <label for="select-model">{{title}}</label>\n    <select id="select-model" class="form-control" ng-model="model" ng-options="item for item in options"></select>\n</div>',restrict:"E",scope:{options:"=",model:"=",title:"@"}}}),angular.module("fallas").directive("fCheckbox",function(){return{template:'<div class="form-group checkbox">\n    <label>\n        <input type="checkbox" ng-model="model"> {{title}}\n    </label>\n    <span ng-click="removeElement()" class="pull-right glyphicon glyphicon-remove"></span>\n</div>',restrict:"E",scope:{model:"=",title:"@"},link:function(a,b){a.model=!0,a.removeElement=function(){b.remove()}}}}),angular.module("fallas").directive("fInputSelector",["$compile","elements",function(a,b){return{template:'<div class="form-group">\n    <label for="select-model">Agregar elemento: </label>\n    <select id="select-model" class="form-control" ng-model="selectedElement"\n            ng-options="element.label for element in elements"\n            ng-change="selectElement()"></select>\n</div>',restrict:"E",scope:{model:"="},link:function(c,d){var e={dateTime:"datetime",checkbox:"checkbox",select:"select"},f={entregaPactada:'<f-date-time-pick title="{{elementLabels.entregaPactada}}" date="model.entregaPactada.date" time=model.entregaPactada.time></f-date-time-pick>',entregaObtenida:'<f-date-time-pick title="{{elementLabels.entregaObtenida}}" date="model.entregaObtenida.date" time=model.entregaObtenida.time></f-date-time-pick>',entregaCompleta:'<f-checkbox title="{{elementLabels.entregaCompleta}}" model="model.entregaCompleta"></f-checkbox>',entregaCorrecta:'<f-checkbox title="{{elementLabels.entregaCorrecta}}" model="model.entregaCorrecta"></f-checkbox>',entregaDefectuosa:'<f-checkbox title="{{elementLabels.entregaDefectuosa}}" model="model.entregaDefectuosa"></f-checkbox>',disponibilidad:'<f-checkbox title="{{elementLabels.disponibilidad}}" model="model.disponibilidad"></f-checkbox>'},g=b.id,h=b.label;c.elements=[{name:g.entregaPactada,type:e.dateTime,label:h.entregaPactada,added:!1},{name:g.entregaObtenida,type:e.dateTime,label:h.entregaObtenida,added:!1},{name:g.entregaCompleta,type:e.checkbox,label:h.entregaCompleta,added:!1},{name:g.entregaCorrecta,type:e.checkbox,label:h.entregaCorrecta,added:!1},{name:g.entregaDefectuosa,type:e.checkbox,label:h.entregaDefectuosa,added:!1},{name:g.disponibilidad,type:e.checkbox,label:h.disponibilidad,added:!1}],c.elementLabels=h,c.selectedElement={},c.selectElement=function(){var b=_.findKey(g,function(a){return a===c.selectedElement.name});if(!c.selectedElement.added){var e=angular.element(f[b]);d.append(a(e)(c))}}}}}]),angular.module("fallas").factory("frame",["rule",function(a){function b(a,b){var c=null;return _.forEach(a,function(a){c=a.evaluate(b)||c}),c}function c(a,b,c,d){function e(a){var b=_.every(this.rules,function(b){return b.evaluate(a)});return b?_.pick(this,"name","severity","correction"):void 0}return _.assign(this,{name:a,severity:b,rules:c,correction:d,evaluate:e}),this}var d={wrongPackaging:[a.definedRules.wrongPackaging],badQualityHardware:[a.definedRules.badQualityHardware],officeNoAvailability:[a.definedRules.officeNoAvailability],delayedSoftware:[a.definedRules.delayedSoftware]},e={wrongPackaging:new c("Proveedor de elementos de packaging con entrega incorrecta","MEDIA",d.wrongPackaging,"La entrega no satisface las especificaciones técnicas del pedido."),badQualityHardware:new c("Proveedor de hardware con calidad defectuosa","GRAVE",d.badQualityHardware,"Los items entregados no satisfacen la evaluación técnica del requiriente."),officeNoAvailability:new c("Proveedor de insumos de oficina sin disponibilidad","MEDIA",d.officeNoAvailability,"El proveedor no posee disponibilidad para satisfacer el pedido."),delayedSoftware:new c("Proveedor de software con entrega atrasada","GRAVE",d.delayedSoftware,"La entrega se realiza posterior al plazo de entrega.")};return{create:c,definedFrames:e,evaluateFrames:b}}]),angular.module("fallas").factory("rule",["characteristics",function(a){function b(a,b,c){function d(a,b){return _.every(b,function(b){return _.has(a,b)})}function e(a){return d(a,this.slots)&&this.procedure(a)}return _.assign(this,{name:a,slots:b,procedure:c,evaluate:e}),this}var c={wrongPackaging:new b("rule",["entregaCorrecta","characteristic"],function(b){return b.entregaCorrecta===!1&&b.characteristic===a[3]}),badQualityHardware:new b("rule",["entregaDefectuosa","characteristic"],function(b){return b.entregaDefectuosa===!0&&b.characteristic===a[1]}),officeNoAvailability:new b("rule",["disponibilidad","characteristic"],function(b){return b.disponibilidad===!1&&b.characteristic===a[2]}),delayedSoftware:new b("rule",["entregaPactada","entregaObtenida","characteristic"],function(b){var c=b.entregaPactada.date,d=b.entregaObtenida.date;return c.setHours(b.entregaPactada.time.getHours(),b.entregaPactada.time.getMinutes()),d.setHours(b.entregaObtenida.time.getHours(),b.entregaObtenida.time.getMinutes()),d>c&&b.characteristic===a[0]})};return{create:b,definedRules:c}}]),angular.module("fallas").constant("characteristics",["Software","Hardware","Insumos","Packaging"]),angular.module("fallas").constant("elements",{id:{entregaPactada:"FECHA_ENTREGA_PACTADA",entregaObtenida:"FECHA_ENTREGA_OBTENIDA",entregaCompleta:"ENTREGA_COMPLETA",entregaCorrecta:"ENTREGA_CORRECTA",entregaDefectuosa:"ENTREGA_DEFECTUOSA",disponibilidad:"DISPONIBILIDAD"},label:{entregaPactada:"Fecha de entrega pactada",entregaObtenida:"Fecha de recibo de entrega",entregaCompleta:"Entrega completa",entregaCorrecta:"Entrega correcta",entregaDefectuosa:"Entrega defectuosa",disponibilidad:"Disponibilidad"}}),angular.module("fallas").directive("fEvaluateResult",function(){return{template:'<div class="panel panel-info">\n    <div class="panel-heading">\n        <h3 class="panel-title">{{result.severity}} - {{result.name}}</h3>\n    </div>\n    <div class="panel-body">\n        {{result.correction}}\n    </div>\n</div>',restrict:"E",scope:{result:"="}}}),angular.module("fallas").controller("ExamplesCtrl",["$scope","frame","characteristics",function(a,b,c){function d(){a.model.example1.result=b.evaluateFrames(_.values(b.definedFrames),a.model.example1.elements),a.model.example2.result=b.evaluateFrames(_.values(b.definedFrames),a.model.example2.elements),a.model.example3.result=b.evaluateFrames(_.values(b.definedFrames),a.model.example3.elements),a.model.example4.result=b.evaluateFrames(_.values(b.definedFrames),a.model.example4.elements)}var e={elements:{characteristic:c[3],entregaCorrecta:!1}},f={elements:{characteristic:c[1],entregaDefectuosa:!0}},g={elements:{characteristic:c[2],disponibilidad:!1}},h={elements:{characteristic:c[0],entregaPactada:{date:new Date(2014,4,5),time:new Date},entregaObtenida:{date:new Date(2014,5,6),time:new Date}}};a.model={example1:e,example2:f,example3:g,example4:h},d()}]),angular.module("fallas").directive("fEvaluateExample",function(){return{template:'<div class="row evaluate-example">\n    <h4>{{title}}</h4>\n    <ul class="list-group">\n        <li class="list-group-item" ng-repeat="(key, value) in elements">{{key}} - {{value}}</li>\n    </ul>\n    <div class="panel panel-info">\n        <div class="panel-heading">\n            <h3 class="panel-title">{{result.severity}} - {{result.name}}</h3>\n        </div>\n        <div class="panel-body">\n            {{result.correction}}\n        </div>\n    </div>\n</div>',restrict:"E",scope:{elements:"=",title:"@",result:"="}}});